<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

	<select id="reviewCnt" resultType="int">
		select count(*) 
		from post inner join member on(post_mem = mem_no)
                 inner join article on(post_gu = artcl_gu 
                                        and post_dong = artcl_dong
                                        and post_zip = artcl_zip
                                        and post_rd = artcl_rd)
		where post_exst = 'N'
			 and post_brd = 1
	</select>

	<!-- 삭제 되지 않은 모든 리뷰 검색 + 페이징 처리 -->
	<select id="searchAllReview" parameterType="pageVo" resultType="reviewVo">
	select * from(
		select rownum rnum ,a.*
		from
		(select post_no,
		       post_mem, 
		       post_ttl,
               post_cntnt,
               post_date,
               post_star,
               post_gu,
               post_dong,
               post_zip,
               post_rd,
		       mem_email
		from post inner join member on(post_mem = mem_no)
                 inner join article on(post_gu = artcl_gu 
                                        and post_dong = artcl_dong
                                        and post_zip = artcl_zip
                                        and post_rd = artcl_rd)
		where post_exst = 'N'
			 and post_brd = 1
		<if test="selBox != null and searchNm != null">
			<if test="selBox == 'email'">
				and mem_email like '%' || #{searchNm} || '%'
			</if>
			<if test="selBox == 'date'">
				and post_date = #{searchNm} 
			</if>
			<if test="selBox == 'all'">
				and mem_email like '%' || #{searchNm} || '%'
				or post_cntnt like '%' || #{searchNm} || '%'
				or post_ttl like '%' || #{searchNm} || '%'
			</if>
		</if>) a)
		where rnum between #{page}*#{pageSize}-(#{pageSize}-1) 
        and #{page}*#{pageSize}
	</select>

	
	<!-- 검색 항목 별 리뷰 검색 -->
	<select id="cateSearchCnt" parameterType="pageVo" resultType="int">
		select count(*) 
		from post inner join member on(post_mem = mem_no)
                 inner join article on(post_gu = artcl_gu 
                                        and post_dong = artcl_dong
                                        and post_zip = artcl_zip
                                        and post_rd = artcl_rd)
		where post_exst = 'N'
			 and post_brd = 1
		 <if test="selBox != null and searchNm != null">
			<if test="selBox == 'email'">
				and mem_email like '%' || #{searchNm} || '%'
			</if>
			<if test="selBox == 'date'">
				and post_date = #{searchNm} 
			</if>
			<if test="selBox == 'all'">
				and mem_email like '%' || #{searchNm} || '%'
				or post_cntnt like '%' || #{searchNm} || '%'
				or post_ttl like '%' || #{searchNm} || '%'
			</if>
		</if>
	</select>
</mapper>