<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="map">
	<!-- 건물 형태와 검색어 검색 리스트 -->
	<!-- 처음 검색 쿼리로 기준은 매매로 정해놓는다. -->
	<select id="searchList" parameterType="map" resultType="buildingSaleVo">
		select artcl_gu, artcl_dong, artcl_complx, artcl_nm,
		artcl_rd, dl_ty,
		artcl_rd_detail,round(avg(dl_price/round(dl_excv_area/3.3,0)),0)as
		avg_dl, artcl_lat,
		artcl_lng
		from article inner join deal on (artcl_gu = dl_gu 
										and
										artcl_dong = dl_dong
										and 
										artcl_zip = dl_zip and artcl_bc = #{building} 
										and
										dl_ty = '매매')
		where artcl_dong = #{searchName}
		or
		artcl_complx like #{searchName} ||'%'
		or
		artcl_nm like #{searchName} ||'%'
		group by artcl_gu, artcl_complx, artcl_nm, artcl_rd, artcl_rd_detail, artcl_dong,artcl_lat, artcl_lng, dl_ty
	</select>

	<select id="searchFilterList" parameterType="filterVo" resultType="buildingSaleVo">
		select artcl_gu, artcl_dong, artcl_complx, artcl_nm, artcl_rd, dl_ty,
		artcl_rd_detail,round(avg(dl_price/round(dl_excv_area/3.3,0)),0)as avg_dl, artcl_lat, artcl_lng
		from article inner join deal on (artcl_gu = dl_gu 
										and
										artcl_dong = dl_dong
										and 
										artcl_zip = dl_zip and artcl_bc = #{building} 
										and
										dl_ty = #{dl_ty})
		where artcl_dong = #{searchName}
		or
		artcl_complx like #{searchName} ||'%'
		or
		artcl_nm like #{searchName} ||'%'
		group by artcl_gu, artcl_complx, artcl_nm, artcl_rd, artcl_rd_detail, artcl_dong,artcl_lat, artcl_lng, dl_ty

	</select>

</mapper>